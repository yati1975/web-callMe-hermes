<!DOCTYPE html>
<html>
<head>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="viewport" charset="UTF-8" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>登入頁面</title>
	 <style>
		body {
			margin: 0;
			border: 0;
			padding: 0;
			font-family: Arial, sans-serif;
			background-color: #f2f2f2;
			color: #000000;
			overflow-x: hidden;
			overflow-y: hidden;

			/* height: 100vh;
			max-height: -webkit-fill-available; */
			/* height: calc(var(--vh, 1vh) * 100); */

			display: flex; /* 將 body 設置為 Flex 容器 */
    		flex-direction: column; /* 讓子元素垂直排列 */
			min-height: 100vh; /* 確保 body 至少佔滿視窗高度，dvh 處理行動裝置更好 */

			/* 關閉點擊時的黑色閃爍 */
			-webkit-tap-highlight-color: transparent;

			/* 禁用文字選取 */
			-webkit-user-select: none; /* Safari, Chrome, Edge (舊版本) */
			-moz-user-select: none;    /* Firefox */
			-ms-user-select: none;     /* Internet Explorer 10+ */
			user-select: none;
		}

		.container {
			display: flex;
			justify-content: center;
			flex-grow: 1;
			height: 45vh;
			overflow-y: hidden;
		}

		.background {
			width: 100%;
			background-color: #f2f2f2;
			text-align: center;
			padding: 2vh;
			box-sizing: border-box;
		}

		.content,
		.content2 {
			list-style-type: none;
			padding-left: 0;
			margin-left: 0;
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			min-height: 5.5vh;
			overflow-y: hidden;
		}

		.content {
			max-height: 16.4vh;
		}

		.content2 {
			max-height: 10.9vh;
		}

		ol li {
			display: inline-block;
			padding: 0.5vh 1vh;
    		border-radius: 1vh;
			margin: 1vw 1vw;
			color: rgb(0, 0, 0);
			font-size: 2.8vh;
			width: 6.8vh;

			max-height: 3.3vh;
			opacity: 1;
			overflow: hidden;
			transition: opacity 0.5s ease-in-out, max-height 0.5s ease-in-out;
		}

		.content li {
			border: 2px solid #FFB182;
			background: #FFB182;
		}

		/* 新增項目時的初始狀態 */
		ol li.new-item-entering {
			opacity: 0;
			max-height: 0;
		}

		/* 移除項目時的動畫效果 */
		ol li.removing-item {
			opacity: 0;
			max-height: 0;
			margin: 0; /* 移除時也清除 margin，讓它更平滑地消失 */
			padding: 0; /* 移除時也清除 padding */
			transition: opacity 0.5s ease-in-out, max-height 0.5s ease-in-out, margin 0.5s ease-in-out, padding 0.5s ease-in-out;
		}

		.content2 li {
			border: 1px solid rgb(0, 0, 0);
			color: rgb(0, 0, 0);
		}

		h1 {
			font-family: monospace, serif;
			font-size: 3.4vh;
			line-height: 5vh;
			margin: 1vh 0;
		}

		h2 {
			font-size: 2.5vh;
			width: 100%;
			text-align: left;
			margin: 0.5vh 0 0.5vh 1vh;
			letter-spacing: 1vw;
		}

		footer {
			padding: 1dvh 0;
			margin-top: auto;
			width: 100%;
			height: 10vh;
		}

		footer font {
			color: #000000;
			font-size: 1.7vh;
			width: 100%;
			box-sizing: border-box;
			line-height: 2.3vh;
			display: flex;
			justify-content: center;
			align-items: center;
			text-align: left;
			letter-spacing: 0.3vw;
		}

		.group-hr {
			width: 100%;
		}

		#dynamic-content-area {
			height: 90vh;
		}

		@supports (height: 100dvh) {
			body {
				min-height: 100dvh;
			}

			.container {
				height: 45dvh;
			}

			.background {
				padding: 2dvh;
			}

			.content,
			.content2 {
				min-height: 5.5dvh;
			}

			.content {
				max-height: 16.4dvh;
			}

			.content2 {
				max-height: 10.9dvh;
			}

			ol li {
				padding: 0.5dvh 1dvh;
				border-radius: 1dvh;
				font-size: 2.8dvh;
				width: 6.8dvh;

				max-height: 3.3dvh;
			}

			h1 {
				font-size: 3.4dvh;
				line-height: 5dvh;
				margin: 1dvh 0;
			}

			h2 {
				font-size: 2.5dvh;
				margin: 0.5dvh 0 0.5dvh 1dvh;
			}

			footer {
				padding: 1dvh 0;
				height: 10dvh;
			}

			footer font {
				font-size: 1.7dvh;
				line-height: 2.3dvh;
			}

			#dynamic-content-area {
				height: 90dvh;
			}
		}

		@media (orientation: landscape) {
			body {
				overflow-y: auto;
			}

			.container {
				height: auto;
			}

			.background {
				width: 100%;
				padding: 2vh;
			}

			.content,
			.content2 {
				min-height: 5.5vw;
			}

			.content {
				max-height: 16.4vw;
			}

			.content2 {
				max-height: 10.9vw;
			}

			ol li {
				padding: 0.5vw 1vw;
				border-radius: 1vw;
				margin: 1vh 1vh;
				font-size: 2.8vw;
				width: 6.8vw;

				max-height: 3.3vw;
			}

			h1 {
				font-size: 3.4vw;
				line-height: 5vh;
				margin: 1vh 0;
			}

			h2 {
				font-size: 2.5vw;
				margin: 0.5vh 0 0.5vh 1vh;
				letter-spacing: 1vw;
			}

			footer {
				padding: 1dvh 0;
				width: 100%;
				height: auto;
			}

			footer font {
				font-size: 1.7vw;
				line-height: 2.3vw;
				letter-spacing: 0.3vh;
			}

			#dynamic-content-area {
				height: auto;
			}
		}
	 </style>
</head>
<body>
	<div id="dynamic-content-area"></div>
	<template id="section-template">
		<div class="container">
			<div class="background">
				<h1>鞋履 SHOES (A)</h1>
				<h2>請下列號碼入場</h2>
				<hr></hr>
				<ol class="content">
					<li>A98</li><li>A99</li><li>A100</li><li>A101</li><li>A102</li>
					<li>A103</li><li>A104</li><li>A105</li><li>A106</li><li>A107</li>
				</ol>
				<h2>即將入場</h2>
				<hr></hr>
				<ol class="content2">
					<li>A98</li><li>A99</li><li>A100</li><li>A101</li><li>A102</li>
					<li>A103</li><li>A104</li><li>A105</li><li>A106</li><li>A107</li>
				</ol>
			</div>
		</div>
		<hr class="group-hr"></hr><br>
	</template>

	<!-- <div class="container">
		<div class="background">
			<h1>絲巾 SILK (B)</h1>
			<h2>請下列號碼入場</h2>
			<hr></hr>
			<ol class="content">
				<li>A98</li><li>A99</li><li>A100</li><li>A101</li><li>A102</li>
				<li>A103</li><li>A104</li><li>A105</li><li>A106</li><li>A107</li>
			</ol>
			<h2>即將入場</h2>
			<hr></hr>
			<ol class="content2">
				<li>A98</li><li>A99</li><li>A100</li><li>A101</li><li>A102</li>
				<li>A103</li><li>A104</li><li>A105</li><li>A106</li><li>A107</li>
			</ol>
		</div>
    </div>
	<hr class="group-hr"></hr> -->
	
	<footer>
		<hr class="group-hr"></hr>
		<font>
			| 一組號碼至多兩位貴賓，每組購物時間為10分鐘<br>
			| 一次抽取單區號碼，10分鐘後方可取下一區號碼<br>
			| 過號請重新取號或於該區現場等候，由同仁安排入場
		</font>
	</footer>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
            const template = document.getElementById('section-template');
            const dynamicContentArea = document.getElementById('dynamic-content-area');

            // 初始化
            const sectionsToGenerate = [
                {
					id: 'SHOES',
					title: '鞋履 SHOES (A)', 
					// currentQueue: [],
					// upcomingQueue: []
					currentQueue: ['A98', 'A99', 'A100', 'A101', 'A102', 'A103', 'A104', 'A105', 'A106', 'A107', 'A108', 'A109', 'A110', 'A111', 'A112'], 
					upcomingQueue: ['A113', 'A114', 'A115', 'A116', 'A117', 'A118'] 
				},
                { 	
					id: 'SILK',
					title: '絲巾 SILK (B)',
					currentQueue: [],
					upcomingQueue: []
					// currentQueue: ['B98', 'B99', 'B100', 'B101', 'B102', 'B103', 'B104', 'B105', 'B106', 'B107', 'B108', 'B109', 'B110', 'B111', 'B112'], 
					// upcomingQueue: ['B113', 'B114', 'B115', 'B116', 'B117', 'B118'] 
				},
                // 更多數據...
            ];

            sectionsToGenerate.forEach(function (data, index) {
                const clone = template.content.cloneNode(true);
				const container = clone.querySelector('.container');
                container.id = `container-${data.id}`;

                const h1 = clone.querySelector('h1');
                if (h1) h1.textContent = data.title;

                const currentQueueOl = clone.querySelector('ol.content');
                if (currentQueueOl) {
                    currentQueueOl.innerHTML = data.currentQueue.map(item => `<li>${item}</li>`).join('');
                }

                const upcomingQueueOl = clone.querySelector('ol.content2');
                if (upcomingQueueOl) {
                    upcomingQueueOl.innerHTML = data.upcomingQueue.map(item => `<li>${item}</li>`).join('');
                }

				if (index === sectionsToGenerate.length-1) {
					const hr = clone.querySelector('.group-hr');
					if (hr) {
						hr.remove();
					}
				}

                dynamicContentArea.appendChild(clone);
            });

			/**
             * 增加項目到指定的 OL 列表。
             * 可選擇是否直接插入到排序好的位置，或直接添加到末尾。
             * @param {string} containerId - 容器的 ID (例如 'SHOES')。
             * @param {string} listClass - 列表的 CSS 類別 (例如 '.content' 或 '.content2')。
             * @param {string} number - 要新增的號碼。
             * @param {boolean} [shouldSort=false] - 如果為 true，則直接插入到排序好的位置；如果為 false，則添加到列表末尾 (預設)。
             */
            function addListItem (containerId, listClass, number, shouldSort = false) {
                const myList = document.querySelector(`#container-${containerId} ${listClass}`);
                if (!myList) {
                    console.warn(`找不到指定的列表：#container-${containerId} ${listClass}`);
                    return;
                }

                const newItem = document.createElement('li');
                newItem.textContent = number;

                // 步驟 1: 新增元素並套用初始過渡類別
                newItem.classList.add('new-item-entering');

                if (shouldSort) {
                    // 如果選擇排序插入，則找到正確的位置插入
                    const existingItems = Array.from(myList.querySelectorAll('li'));
                    let inserted = false;

                    for (let i = 0; i < existingItems.length; i++) {
                        const existingText = existingItems[i].textContent.trim();
                        // 比較新項目和現有項目的順序
                        if (number.localeCompare(existingText, undefined, { numeric: true, sensitivity: 'base' }) < 0) {
                            myList.insertBefore(newItem, existingItems[i]);
                            inserted = true;
                            break; // 找到位置就跳出循環
                        }
                    }

                    // 如果循環結束後還沒有插入，表示新項目是最大的，直接添加到列表末尾
                    if (!inserted) {
                        myList.appendChild(newItem);
                    }
                } else {
                    // 如果不選擇排序插入，則直接添加到列表末尾 (原有的簡單添加邏輯)
                    myList.appendChild(newItem);
                }

                // 步驟 2: 強制瀏覽器重繪 (Triggers reflow/re-render)
                void newItem.offsetWidth;

                // 步驟 3: 移除初始過渡類別，觸發過渡效果
                newItem.classList.remove('new-item-entering');

                // 注意：這裡不需要額外的 transitionend 監聽器來觸發 sortListItems。
                // 因為當 shouldSort 為 true 時，項目已經直接插入到排序好的位置；
                // 當 shouldSort 為 false 時，項目就是添加到末尾，也不需要重新排序。
            }

			/**
             * 從指定的 OL 列表移除特定號碼的項目。
             * @param {string} containerId - 容器的 ID (例如 'SHOES')。
             * @param {string} listClass - 列表的 CSS 類別 (例如 '.content' 或 '.content2')。
             * @param {string} number - 要移除的號碼。
             * @returns {boolean} - 如果找到並移除了項目則返回 true，否則返回 false。
             */
            function removeListItem (containerId, listClass, number) {
                const myList = document.querySelector(`#container-${containerId} ${listClass}`);
                if (!myList) {
                    console.warn(`找不到指定的列表：#container-${containerId} ${listClass}`);
                    return false;
                }

                const items = myList.querySelectorAll('li');
                let itemFound = false;
                items.forEach(item => {
                    if (item.textContent === number) {
                        itemFound = true;
                        item.classList.add('removing-item');
                        item.addEventListener('transitionend', function handler() {
                            item.removeEventListener('transitionend', handler);
                            item.remove();
                        });
                    }
                });
                return itemFound;
            }

			 /**
             * 依照號碼對指定的 <ol> 列表進行排序。
             * @param {string} listSelector - 要排序的 <ol> 元素的 CSS 選擇器。
             */
            function sortListItems(listSelector) {
                const olElement = document.querySelector(listSelector);

                if (!olElement) {
                    console.warn(`找不到指定的列表元素：${listSelector}`);
                    return;
                }

                const items = Array.from(olElement.querySelectorAll('li'));

                items.sort((a, b) => {
                    const textA = a.textContent.trim();
                    const textB = b.textContent.trim();
                    return textA.localeCompare(textB, undefined, { numeric: true, sensitivity: 'base' });
                });

                // 使用 DocumentFragment 提高 DOM 操作效率
                const fragment = document.createDocumentFragment();
                items.forEach(item => {
                    fragment.appendChild(item);
                });
                olElement.innerHTML = ''; // 清空原有列表
                olElement.appendChild(fragment); // 一次性添加所有排序後的項目
                console.log(`列表 ${listSelector} 已成功排序。`);
            }

			/**
             * 用一個新的陣列來更新指定的 <ol> 列表。
             * 現有項目會被移除，新項目會被逐一添加。
             * @param {string} containerId - 容器的 ID (例如 'SHOES')。
             * @param {string} listClass - 列表的 CSS 類別 (例如 '.content' 或 '.content2')。
             * @param {Array<string>} newItemsArray - 包含所有新號碼的陣列。
             * @param {boolean} [shouldSort=true] - 更新後是否進行排序，預設為 true。
             * @param {number} [transitionDelay=50] - 每個項目添加之間的延遲 (毫秒)，預設為 50ms。
             */
			function updateListWithArray(containerId, listClass, newItemsArray, shouldSort = true, transitionDelay = 50) {
				const myList = document.querySelector(`#container-${containerId} ${listClass}`);
				if (!myList) {
					console.warn(`更新列表失敗：找不到指定的列表：#container-${containerId} ${listClass}`);
					return;
				}

				// 1. 清空所有現有項目，帶有移除動畫
				const existingItems = Array.from(myList.querySelectorAll('li'));
				if (existingItems.length > 0) {
					let itemsRemovedCount = 0;
					existingItems.forEach(item => {
						item.classList.add('removing-item'); // 添加移除動畫類別
						item.addEventListener('transitionend', function handler() {
							item.removeEventListener('transitionend', handler);
							item.remove(); // 動畫結束後移除 DOM 元素
							itemsRemovedCount++;
							// 當所有舊項目都移除後，才開始添加新項目
							if (itemsRemovedCount === existingItems.length) {
								addNewItemsSequentially(newItemsArray);
							}
						});
					});
				} else {
					// 如果沒有舊項目，直接添加新項目
					addNewItemsSequentially(newItemsArray);
				}

				// 輔助函數：逐一添加新項目
				function addNewItemsSequentially(itemsToAdd) {
					let i = 0;
					function addNextItem() {
						if (i < itemsToAdd.length) {
							// 使用 addListItem，但暫不在此處單獨排序，因為最後會統一排序
							addListItem(containerId, listClass, itemsToAdd[i], false);
							i++;
							setTimeout(addNextItem, transitionDelay); // 每個項目添加之間有延遲，營造逐一出現效果
						} else {
							// 所有新項目都添加完畢後，執行最終排序
							if (shouldSort) {
								sortListItems(`#container-${containerId} ${listClass}`);
							}
						}
					}
					// 在開始添加新項目之前，等待舊項目完全移除的過渡時間
					// 這裡確保了舊項目移除動畫有足夠時間播放，然後才開始新項目出現
					const delayBeforeAdding = existingItems.length > 0 ? 500 : 0; // 500ms 是 removing-item 的過渡時間
					setTimeout(addNextItem, delayBeforeAdding);
				}
			}

			setTimeout( function() {
				addListItem('SHOES', '.content', 'A113');
				addListItem('SILK', '.content', 'A113');
			} , 2000);
			setTimeout( function() {
				addListItem('SILK', '.content2', 'A114');
			} , 3000);
			setTimeout( function() {
				addListItem('SILK', '.content2', 'A115');
			} , 4000);

			setTimeout( function() {
				removeListItem('SHOES', '.content', 'A98');
				removeListItem('SHOES', '.content', 'A103');
			} , 5000);

			setTimeout( function() {
				removeListItem('SILK', '.content2', 'A114');
			} , 6000);

			setTimeout( function() {
				addListItem('SHOES', '.content', 'A98');
				addListItem('SHOES', '.content', 'A103', true);		//	排序加入
				addListItem('SHOES', '.content2', 'A119');
				addListItem('SHOES', '.content2', 'A120');
				addListItem('SHOES', '.content2', 'A121');
				addListItem('SHOES', '.content2', 'A122');
				addListItem('SHOES', '.content2', 'A123');
			} , 7000);

			setTimeout(function() {
				const newShoesCurrentQueue = ['A01', 'A05', 'A03', 'A02', 'A04', 'A10', 'A07']; // 新的號碼陣列
				updateListWithArray('SHOES', '.content', newShoesCurrentQueue);
			}, 8000);
			
		});
	</script>
</body>
</html>